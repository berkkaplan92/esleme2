<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>Pika & Berk – V22.6 Final</title>
<style>
:root{
  --card-w:160px;
  --card-h:200px;
}
*{box-sizing:border-box;}
body{
  margin:0;
  background:linear-gradient(to bottom right,#b3e5fc,#e1f5fe);
  height:100vh;
  overflow:hidden;
  font-family:"Comic Sans MS",system-ui,sans-serif;
  position:relative;
}

/* YÖNERGE */
#instructionBox{
  position:absolute;
  top:50px;
  left:40px;
  background:#fff9e6;
  border:3px solid #f6c453;
  border-radius:14px;
  padding:10px 14px;
  box-shadow:0 3px 8px rgba(0,0,0,.12);
  z-index:20;
  min-width:210px;
}
#instructionBox .title{
  font-weight:700;
  margin-bottom:4px;
}
#instructionBox .line{
  font-weight:700;
  font-size:13px;
  text-transform:uppercase;
  margin:1px 0;
}

/* üstteki sabit kartlar */
.option-card{
  width:var(--card-w);
  height:var(--card-h);
  background:#fff;
  border:3px solid rgba(11,132,165,.4);
  border-radius:16px;
  box-shadow:0 4px 10px rgba(0,0,0,.15);
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:flex-start;
  position:absolute;
  transition:all .35s ease;
  user-select:none;
  z-index:10;
}
/* biraz daha yaklaştırdık */
#optionLeft{top:14%;left:25%;}
#optionRight{top:14%;right:25%;}
.option-card img{
  width:100px;height:100px;object-fit:contain;margin-top:4px;pointer-events:none;
}
.label-tr-top{
  font-weight:700;
  text-transform:uppercase;
  margin-top:4px;
  text-align:center;
}
.label-en-bottom{
  font-size:12px;
  text-align:center;
  margin-top:2px;
  opacity:.8;
}

/* alttaki sürüklenen kart */
#dragCard{
  width:var(--card-w);
  height:var(--card-h);
  background:#fff;
  border:3px solid rgba(11,132,165,.6);
  border-radius:16px;
  box-shadow:0 6px 10px rgba(0,0,0,.35);
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:flex-start;
  position:absolute;
  bottom:18%;
  left:50%;
  transform:translateX(-50%);
  cursor:grab;
  user-select:none;
  touch-action:none;
  z-index:200;
  transition:box-shadow .15s ease,border-color .15s ease;
}
#dragCard img{
  width:100px;height:100px;object-fit:contain;margin-top:4px;pointer-events:none;
}
.correct{border-color:#2ecc71!important;box-shadow:0 0 18px rgba(46,204,113,.9)!important;}
.wrong{border-color:#e74c3c!important;box-shadow:0 0 18px rgba(231,76,60,.9)!important;}

/* SABİT sembol bar – kartın altında, hareket etmiyor */
#symbolBar{
  position:absolute;
  bottom:10%;
  left:50%;
  transform:translateX(-50%);
  display:flex;
  gap:5px;
  background:rgba(255,255,255,.55);
  padding:5px 10px;
  border-radius:10px;
  box-shadow:0 2px 6px rgba(0,0,0,.15);
  z-index:120;
}
.bar-slot{
  width:20px;height:20px;
  background:rgba(255,255,255,.3);
  border-radius:5px;
  display:flex;align-items:center;justify-content:center;
  font-size:16px;
}
.bar-slot.active{background:rgba(255,255,255,.95);}

/* sağ alttaki AHŞAP sembol tahtası */
#symbolBoard{
  position:absolute;
  bottom:20px;
  right:20px;
  width:260px;
  height:110px;
  background:url('https://cdn.pixabay.com/photo/2014/04/02/10/56/wood-306955_1280.png') center/cover no-repeat;
  border-radius:16px;
  display:flex;
  flex-wrap:wrap;
  justify-content:center;
  align-items:center;
  gap:6px;
  padding:10px;
  box-shadow:0 4px 10px rgba(0,0,0,.25);
}
.slot{
  width:30px;height:30px;border-radius:8px;
  background:rgba(255,255,255,.25);
  text-align:center;line-height:30px;font-size:22px;
  opacity:.25;transition:all .25s ease;
  cursor:pointer;
}
.slot.active{opacity:1;transform:scale(1.05);}

/* uçan yıldız – bar’dan değil ekrandan tahtaya kayıyor */
#flyStar{
  position:absolute;
  width:40px;height:40px;
  background:gold;border-radius:50%;
  box-shadow:0 0 12px rgba(255,215,0,.9);
  top:50%;left:50%;
  transform:translate(-50%,-50%) scale(0);
  opacity:0;
  pointer-events:none;
  z-index:999;
  transition:all .35s ease;
}

@media (max-width:540px){
  #optionLeft{left:8%;}
  #optionRight{right:8%;}
  #instructionBox{left:10px;top:30px;}
  #symbolBar{bottom:12%;}
}
</style>
</head>
<body>

<!-- YÖNERGE -->
<div id="instructionBox">
  <div class="title">YÖNERGE :</div>
  <div class="line" id="line1">- EŞLE</div>
  <div class="line" id="line2">- AYNI OLANI EŞLE</div>
  <div class="line" id="line3">- ELMAYI EŞLE</div>
</div>

<!-- Üstteki iki kart -->
<div class="option-card" id="optionLeft">
  <img id="leftImg" src="">
  <div class="label-tr-top" id="leftTr"></div>
  <div class="label-en-bottom" id="leftEn"></div>
</div>
<div class="option-card" id="optionRight">
  <img id="rightImg" src="">
  <div class="label-tr-top" id="rightTr"></div>
  <div class="label-en-bottom" id="rightEn"></div>
</div>

<!-- Alttaki sürüklenen kart -->
<div id="dragCard">
  <img id="dragImg" src="">
  <div class="label-tr-top" id="dragTr"></div>
  <div class="label-en-bottom" id="dragEn"></div>
</div>

<!-- SABİT sembol barı (8’li) -->
<div id="symbolBar">
  <div class="bar-slot" id="b1">⭐</div>
  <div class="bar-slot" id="b2">⭐</div>
  <div class="bar-slot" id="b3">⭐</div>
  <div class="bar-slot" id="b4">⭐</div>
  <div class="bar-slot" id="b5">⭐</div>
  <div class="bar-slot" id="b6">⭐</div>
  <div class="bar-slot" id="b7">⭐</div>
  <div class="bar-slot" id="b8">⭐</div>
</div>

<!-- Sağ alttaki sembol tahtası -->
<div id="symbolBoard">
  <div class="slot" id="s1"></div>
  <div class="slot" id="s2"></div>
  <div class="slot" id="s3"></div>
  <div class="slot" id="s4"></div>
  <div class="slot" id="s5"></div>
  <div class="slot" id="s6"></div>
  <div class="slot" id="s7"></div>
  <div class="slot" id="s8"></div>
</div>

<!-- Uçan sembol -->
<div id="flyStar"></div>

<!-- Sesler -->
<audio id="correctSound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_bf4d03054b.mp3"></audio>
<audio id="wrongSound"   src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_21cda77a64.mp3"></audio>

<script>
/* 50 NESNELİ HAVUZ */
const ITEMS = [
  // meyveler
  {id:"elma", tr:"Elma", en:"Apple"},
  {id:"muz", tr:"Muz", en:"Banana"},
  {id:"armut", tr:"Armut", en:"Pear"},
  {id:"uzum", tr:"Üzüm", en:"Grapes"},
  {id:"ananas", tr:"Ananas", en:"Pineapple"},
  {id:"cilek", tr:"Çilek", en:"Strawberry"},
  {id:"karpuz", tr:"Karpuz", en:"Watermelon"},
  {id:"kavun", tr:"Kavun", en:"Melon"},
  {id:"portakal", tr:"Portakal", en:"Orange"},
  {id:"kivi", tr:"Kivi", en:"Kiwi"},
  // sebzeler
  {id:"domates", tr:"Domates", en:"Tomato"},
  {id:"salatalik", tr:"Salatalık", en:"Cucumber"},
  {id:"biber", tr:"Biber", en:"Pepper"},
  {id:"sarimsak", tr:"Sarımsak", en:"Garlic"},
  {id:"sogan", tr:"Soğan", en:"Onion"},
  {id:"brokoli", tr:"Brokoli", en:"Broccoli"},
  {id:"havuc", tr:"Havuç", en:"Carrot"},
  {id:"lahana", tr:"Lahana", en:"Cabbage"},
  {id:"misir", tr:"Mısır", en:"Corn"},
  {id:"patlican", tr:"Patlıcan", en:"Eggplant"},
  // taşıtlar
  {id:"kamyon", tr:"Kamyon", en:"Truck"},
  {id:"araba", tr:"Araba", en:"Car"},
  {id:"motosiklet", tr:"Motosiklet", en:"Motorcycle"},
  {id:"bisiklet", tr:"Bisiklet", en:"Bicycle"},
  {id:"gemi", tr:"Gemi", en:"Ship"},
  {id:"helikopter", tr:"Helikopter", en:"Helicopter"},
  {id:"ucak", tr:"Uçak", en:"Plane"},
  {id:"tren", tr:"Tren", en:"Train"},
  {id:"otobus", tr:"Otobüs", en:"Bus"},
  {id:"itfaiye_arabasi", tr:"İtfaiye Arabası", en:"Fire Truck"},
  // hayvanlar (20)
  {id:"aslan", tr:"Aslan", en:"Lion"},
  {id:"kaplan", tr:"Kaplan", en:"Tiger"},
  {id:"kedi", tr:"Kedi", en:"Cat"},
  {id:"kopek", tr:"Köpek", en:"Dog"},
  {id:"inek", tr:"İnek", en:"Cow"},
  {id:"at", tr:"At", en:"Horse"},
  {id:"koyun", tr:"Koyun", en:"Sheep"},
  {id:"keci", tr:"Keçi", en:"Goat"},
  {id:"tavuk", tr:"Tavuk", en:"Chicken"},
  {id:"ordek", tr:"Ördek", en:"Duck"},
  {id:"kus", tr:"Kuş", en:"Bird"},
  {id:"tavsan", tr:"Tavşan", en:"Rabbit"},
  {id:"balik", tr:"Balık", en:"Fish"},
  {id:"fil", tr:"Fil", en:"Elephant"},
  {id:"ayi", tr:"Ayı", en:"Bear"},
  {id:"maymun", tr:"Maymun", en:"Monkey"},
  {id:"kurbaga", tr:"Kurbağa", en:"Frog"},
  {id:"kaplumbaga", tr:"Kaplumbağa", en:"Turtle"},
  {id:"domuz", tr:"Domuz", en:"Pig"},
  {id:"yunus", tr:"Yunus", en:"Dolphin"},
];

const instructionLine3 = document.getElementById("line3");

const optionLeft = document.getElementById("optionLeft");
const optionRight = document.getElementById("optionRight");
const leftImg = document.getElementById("leftImg");
const rightImg = document.getElementById("rightImg");
const leftTr = document.getElementById("leftTr");
const rightTr = document.getElementById("rightTr");
const leftEn = document.getElementById("leftEn");
const rightEn = document.getElementById("rightEn");

const dragCard = document.getElementById("dragCard");
const dragImg = document.getElementById("dragImg");
const dragTr = document.getElementById("dragTr");
const dragEn = document.getElementById("dragEn");

const barSlots = [
  document.getElementById("b1"),
  document.getElementById("b2"),
  document.getElementById("b3"),
  document.getElementById("b4"),
  document.getElementById("b5"),
  document.getElementById("b6"),
  document.getElementById("b7"),
  document.getElementById("b8"),
];

const symbolBoard = document.getElementById("symbolBoard");
const boardSlots = [
  document.getElementById("s1"),
  document.getElementById("s2"),
  document.getElementById("s3"),
  document.getElementById("s4"),
  document.getElementById("s5"),
  document.getElementById("s6"),
  document.getElementById("s7"),
  document.getElementById("s8"),
];

const flyStar = document.getElementById("flyStar");
const correctSound = document.getElementById("correctSound");
const wrongSound = document.getElementById("wrongSound");

let currentItem = null;
let wrongItem = null;
let attempt = 1;
let collected = 0;
let countingMode = false;
let counted = 0;

// pekiştireçler
const praiseTexts = ["Aferin","Bravo","Süpersin","Harika gidiyorsun"];
// sayma sesini speechSynthesis ile yapacağız

function randomItem(){
  return ITEMS[Math.floor(Math.random()*ITEMS.length)];
}

function toAccusative(word){
  const lower = word.toLowerCase("tr");
  const vowels = "aıoueiöü";
  const last = lower.charAt(lower.length-1);
  const isVowel = vowels.includes(last);
  const lastVowel = (lower.match(/[aıoueöü]/g)||["a"]).slice(-1)[0];
  let ek="ı";
  if(["e","i","ö","ü"].includes(lastVowel)) ek="i";
  if(["o","u"].includes(lastVowel)) ek="u";
  if(["a","ı"].includes(lastVowel)) ek="ı";
  if(["ö","ü"].includes(lastVowel)) ek="ü";
  if(isVowel){
    return word+"y"+ek;
  }else{
    if(last==="k" && (ek==="i"||ek==="ü")){
      return word.slice(0,-1)+"ğ"+ek;
    }
    return word+ek;
  }
}

function updateInstruction(){
  const acc = toAccusative(currentItem.tr).toUpperCase();
  instructionLine3.textContent = "- " + acc + " EŞLE";
}

function renderQuestion(shuffle=true){
  updateInstruction();
  const correct = currentItem;
  const wrong = wrongItem;
  let arr = [correct, wrong];
  if(shuffle) arr.sort(()=>Math.random()-.5);

  // sol
  const l = arr[0];
  leftImg.src = `assets/${l.id}.png`;
  leftTr.textContent = l.tr.toUpperCase();
  leftEn.textContent = l.en.toUpperCase();
  leftImg.dataset.id = l.id;

  // sağ
  const r = arr[1];
  rightImg.src = `assets/${r.id}.png`;
  rightTr.textContent = r.tr.toUpperCase();
  rightEn.textContent = r.en.toUpperCase();
  rightImg.dataset.id = r.id;

  // drag
  dragImg.src = `assets/${currentItem.id}.png`;
  dragTr.textContent = currentItem.tr.toUpperCase();
  dragEn.textContent = currentItem.en.toUpperCase();

  resetDragPosition();
}

function loadNew(){
  currentItem = randomItem();
  do { wrongItem = randomItem(); } while(wrongItem.id === currentItem.id);
  attempt = 1;
  renderQuestion(true);
}

function resetDragPosition(){
  dragCard.style.transition = "all .25s ease";
  dragCard.style.left = "50%";
  dragCard.style.bottom = "18%";
  dragCard.style.top = "";
  dragCard.style.transform = "translateX(-50%)";
}

/* DRAG */
let isDragging=false,startX=0,startY=0,startLeft=0,startTop=0;

dragCard.addEventListener("mousedown",dragStart);
dragCard.addEventListener("touchstart",dragStart,{passive:false});

function dragStart(e){
  e.preventDefault();
  isDragging=true;
  const p=e.touches?e.touches[0]:e;
  startX=p.clientX; startY=p.clientY;
  const rect=dragCard.getBoundingClientRect();
  startLeft=rect.left; startTop=rect.top;
  dragCard.style.transition="none";
  dragCard.style.cursor="grabbing";

  document.addEventListener("mousemove",dragging);
  document.addEventListener("touchmove",dragging,{passive:false});
  document.addEventListener("mouseup",dragEnd);
  document.addEventListener("touchend",dragEnd);
}

function dragging(e){
  if(!isDragging) return;
  const p=e.touches?e.touches[0]:e;
  const dx=p.clientX-startX;
  const dy=p.clientY-startY;
  dragCard.style.left=(startLeft+dx)+"px";
  dragCard.style.top=(startTop+dy)+"px";
  dragCard.style.transform="none";
}

function dragEnd(){
  if(!isDragging) return;
  isDragging=false;
  dragCard.style.cursor="grab";
  document.removeEventListener("mousemove",dragging);
  document.removeEventListener("touchmove",dragging);
  document.removeEventListener("mouseup",dragEnd);
  document.removeEventListener("touchend",dragEnd);

  const dRect=dragCard.getBoundingClientRect();
  const lRect=optionLeft.getBoundingClientRect();
  const rRect=optionRight.getBoundingClientRect();
  const hitL=isOverlap(dRect,lRect);
  const hitR=isOverlap(dRect,rRect);

  if(hitL||hitR){
    const chosen = hitL ? leftImg.dataset.id : rightImg.dataset.id;
    if(chosen === currentItem.id){
      handleCorrect();
    } else {
      handleWrong();
    }
  } else {
    resetDragPosition();
  }
}

function isOverlap(a,b){
  return !(a.right<b.left||a.left>b.right||a.bottom<b.top||a.top>b.bottom);
}

/* SES */
function speakTR(text){
  if(!("speechSynthesis" in window)) return;
  const u=new SpeechSynthesisUtterance(text);
  u.lang="tr-TR";
  speechSynthesis.speak(u);
}

/* DOĞRU/YANLIŞ */
function handleCorrect(){
  dragCard.classList.add("correct");
  correctSound.currentTime=0;
  correctSound.play().catch(()=>{});
  // random pekiştireç
  const msg = praiseTexts[Math.floor(Math.random()*praiseTexts.length)];
  speakTR(msg);

  // sembol işle
  gainSymbol();

  if(attempt===1){
    setTimeout(()=>{
      dragCard.classList.remove("correct");
      swapTopCards();
      attempt=2;
      resetDragPosition();
    },500);
  } else {
    setTimeout(()=>{
      dragCard.classList.remove("correct");
      loadNew();
    },500);
  }
}

function handleWrong(){
  dragCard.classList.add("wrong");
  wrongSound.currentTime=0;
  wrongSound.play().catch(()=>{});
  setTimeout(()=>{
    dragCard.classList.remove("wrong");
    resetDragPosition();
  },500);
}

function swapTopCards(){
  const lsrc=leftImg.src, lid=leftImg.dataset.id, ltr=leftTr.textContent, len=leftEn.textContent;
  leftImg.src=rightImg.src; leftImg.dataset.id=rightImg.dataset.id; leftTr.textContent=rightTr.textContent; leftEn.textContent=rightEn.textContent;
  rightImg.src=lsrc; rightImg.dataset.id=lid; rightTr.textContent=ltr; rightEn.textContent=len;
}

/* Sembol kazanma: bar sabit, ekranda yıldız belirip tahtaya kayıyor */
function gainSymbol(){
  if(collected>=8) return;

  // bar’da göster (aktif yap)
  barSlots[collected].classList.add("active");

  // uçan yıldız animasyonu
  flyStar.style.top = "65%";
  flyStar.style.left = "50%";
  flyStar.style.opacity = 1;
  flyStar.style.transform = "translate(-50%,-50%) scale(1)";
  // hedef: sağ alttaki tahtanın ortası
  setTimeout(()=>{
    flyStar.style.top = "82%";
    flyStar.style.left = "88%";
    flyStar.style.opacity = 0;
    flyStar.style.transform = "translate(-50%,-50%) scale(.3)";
  },100);

  // tahtadaki slotu doldur
  setTimeout(()=>{
    boardSlots[collected].textContent="⭐";
    boardSlots[collected].classList.add("active");
    collected++;
    // 8 olduysa sayma moduna geç
    if(collected===8){
      setTimeout(()=>{
        speakTR("Hadi sembolleri sayalım.");
        countingMode=true;
        counted=0;
      },500);
    }
  },400);
}

/* Tahtadaki sembollere tıklayıp sayma ve bar’a geri gönderme */
boardSlots.forEach((slot,idx)=>{
  slot.addEventListener("click", ()=>{
    if(!countingMode) return;
    if(!slot.classList.contains("active")) return;

    // sembolü tahtadan sil
    slot.classList.remove("active");
    slot.textContent="";
    counted++;

    // sayıyı seslendir
    const numbers = ["bir","iki","üç","dört","beş","altı","yedi","sekiz"];
    speakTR(numbers[counted-1]);

    // bar’da boşalan ilk yeri bul ve pasif yapma yerine "geri döndü" gibi gösterelim
    // burada mantık: çocuk saydıkça semboller bar’a "geri geliyor"
    const firstInactive = barSlots.findIndex(bs => !bs.classList.contains("active"));
    if(firstInactive !== -1){
      barSlots[firstInactive].classList.add("active");
    }

    // eğer 8. sembolü de saydıysa final
    if(counted===8){
      setTimeout(()=>{
        speakTR("Bravo! Tüm sembolleri topladın.");
        // resetle
        collected=0;
        countingMode=false;
        counted=0;
        // bar ve tahta temizlensin
        barSlots.forEach(bs=>bs.classList.remove("active"));
        boardSlots.forEach(bs=>{bs.classList.remove("active");bs.textContent="";});
      },700);
    }
  });
});

/* başlangıç */
window.addEventListener("load", ()=>{
  loadNew();
});
</script>
</body>
</html>
