<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Pika & Berk – V19 Eşleme</title>
<style>
:root {
  --card-w: 160px;
  --card-h: 200px;
}
*{box-sizing:border-box;}
body{
  margin:0;
  background:linear-gradient(to bottom right,#b3e5fc,#e1f5fe);
  height:100vh;
  overflow:hidden;
  font-family:"Comic Sans MS",system-ui,sans-serif;
  position:relative;
}
#splash{
  position:fixed;inset:0;
  background:radial-gradient(circle at top,#ffe082,#ffcc80);
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  z-index:9999;
  animation:fadeOut .5s ease 2.2s forwards;
}
#splash h1{margin:0;font-size:26px;}
#splash p{margin-top:8px;font-weight:700;}
@keyframes fadeOut{to{opacity:0;visibility:hidden;}}
#instruction{
  position:absolute;top:12px;left:16px;
  background:rgba(255,255,255,.9);
  padding:8px 16px;border-radius:12px;
  font-weight:700;text-transform:uppercase;
  box-shadow:0 2px 6px rgba(0,0,0,.12);
  z-index:10;
}
/* üstte sabit 2 kart */
.option-card{
  width:var(--card-w);height:var(--card-h);
  background:#fff;border:3px solid rgba(11,132,165,.4);
  border-radius:16px;box-shadow:0 4px 10px rgba(0,0,0,.15);
  display:flex;flex-direction:column;align-items:center;justify-content:flex-start;
  position:absolute;transition:all .35s ease;user-select:none;z-index:10;
}
#optionLeft{top:14%;left:18%;}
#optionRight{top:14%;right:18%;}
.option-card img{width:100px;height:100px;object-fit:contain;margin-top:10px;pointer-events:none;}
.label{font-weight:700;text-transform:uppercase;margin-top:8px;text-align:center;}
/* alttaki sürüklenen kart */
#dragCard{
  width:var(--card-w);height:var(--card-h);
  background:#fff;border:3px solid rgba(11,132,165,.6);
  border-radius:16px;box-shadow:0 6px 10px rgba(0,0,0,.35);
  display:flex;flex-direction:column;align-items:center;justify-content:flex-start;
  position:absolute;bottom:14%;left:50%;transform:translateX(-50%);
  cursor:grab;user-select:none;touch-action:none;z-index:200;
  transition:box-shadow .15s ease,border-color .15s ease;
}
#dragCard img{width:100px;height:100px;object-fit:contain;margin-top:10px;pointer-events:none;}
.correct{border-color:#2ecc71!important;box-shadow:0 0 18px rgba(46,204,113,.9)!important;}
.wrong{border-color:#e74c3c!important;box-shadow:0 0 18px rgba(231,76,60,.9)!important;}

/* kartın altındaki mini sembol bar */
#slotBar{
  position:absolute;
  bottom:-42px;
  left:50%;
  transform:translateX(-50%);
  display:flex;
  gap:6px;
}
.mini-slot{
  width:24px;height:24px;
  background:rgba(255,255,255,.4);
  border-radius:6px;
  display:flex;align-items:center;justify-content:center;
  font-size:18px;
  opacity:.2;
  pointer-events:none;
}

/* sembol tahtası */
#symbolBoard{
  position:absolute;bottom:20px;right:20px;
  width:280px;height:130px;
  background:url('https://cdn.pixabay.com/photo/2014/04/02/10/56/wood-306955_1280.png') center/cover no-repeat;
  border-radius:16px;display:flex;flex-wrap:wrap;justify-content:center;align-items:center;
  padding:10px;box-shadow:0 4px 10px rgba(0,0,0,.25);
}
.slot{
  width:28px;height:28px;border-radius:8px;
  background:rgba(255,255,255,.3);
  margin:4px;font-size:22px;text-align:center;line-height:28px;
  opacity:.25;transition:all .3s ease;cursor:pointer;
}
.slot.active{opacity:1;}

/* ortada beliren yıldız */
#flyStar{
  position:absolute;width:60px;height:60px;
  background:gold;border-radius:50%;
  box-shadow:0 0 12px rgba(255,215,0,.9);
  top:50%;left:50%;
  transform:translate(-50%,-50%) scale(0);
  opacity:0;pointer-events:none;z-index:999;transition:all .25s ease;
}
@media(max-width:540px){
  #optionLeft{left:6%;}
  #optionRight{right:6%;}
  #symbolBoard{transform:scale(.85);right:4px;}
}
</style>
</head>
<body>
  <!-- Splash -->
  <div id="splash">
    <h1>Powered by Pika & Berk</h1>
    <p>Özel Eğitim Eşleme Modülü</p>
  </div>

  <div id="instruction">YÖNERGE: EŞLE</div>

  <!-- üst sabit kartlar -->
  <div class="option-card" id="optionLeft">
    <img id="leftImg" src="">
    <div class="label" id="leftLabel"></div>
  </div>
  <div class="option-card" id="optionRight">
    <img id="rightImg" src="">
    <div class="label" id="rightLabel"></div>
  </div>

  <!-- alttaki sürüklenen kart -->
  <div class="card" id="dragCard">
    <img id="dragImg" src="">
    <div class="label" id="dragLabel"></div>
    <div id="slotBar">
      <div class="mini-slot" id="m1"></div>
      <div class="mini-slot" id="m2"></div>
      <div class="mini-slot" id="m3"></div>
      <div class="mini-slot" id="m4"></div>
      <div class="mini-slot" id="m5"></div>
    </div>
  </div>

  <!-- sembol tahtası -->
  <div id="symbolBoard"></div>

  <!-- uçan yıldız -->
  <div id="flyStar"></div>

  <!-- sesler -->
  <audio id="correctSound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_bf4d03054b.mp3"></audio>
  <audio id="wrongSound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_21cda77a64.mp3"></audio>
  <audio id="praise" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_c3b37f01ab.mp3"></audio>

<script>
/* ---------- veri ---------- */
const pool=[
  {id:"elma",tr:"Elma"},
  {id:"muz",tr:"Muz"},
  {id:"armut",tr:"Armut"},
  {id:"patlican",tr:"Patlıcan"},
  {id:"domates",tr:"Domates"},
  {id:"sarimsak",tr:"Sarımsak"},
  {id:"araba",tr:"Araba"},
  {id:"otobus",tr:"Otobüs"},
  {id:"ucak",tr:"Uçak"},
  {id:"kopek",tr:"Köpek"}
];
const instruction=document.getElementById("instruction");
const optionLeft=document.getElementById("optionLeft");
const optionRight=document.getElementById("optionRight");
const leftImg=document.getElementById("leftImg");
const rightImg=document.getElementById("rightImg");
const leftLabel=document.getElementById("leftLabel");
const rightLabel=document.getElementById("rightLabel");
const dragCard=document.getElementById("dragCard");
const dragImg=document.getElementById("dragImg");
const dragLabel=document.getElementById("dragLabel");
const symbolBoard=document.getElementById("symbolBoard");
const flyStar=document.getElementById("flyStar");
const correctSound=document.getElementById("correctSound");
const wrongSound=document.getElementById("wrongSound");
const praiseSound=document.getElementById("praise");
const miniSlots=[...document.querySelectorAll(".mini-slot")]; // kart altındaki sabit mini bar

/* pekiştireç sesleri (TTS ile söyleyeceğiz) */
const praiseTexts=[
  "Bravo sana!",
  "Aferin sana!",
  "Harika gidiyorsun!",
  "Süpersin!"
];

/* sembol tahtası 10'lu */
const slots=[];
for(let i=0;i<10;i++){
  const s=document.createElement("div");
  s.className="slot";
  symbolBoard.appendChild(s);
  slots.push(s);
}

/* durumlar */
let currentItem=null;
let wrongItem=null;
let attempt=1;
let symbolCount=0;     // tahtadaki semboller
let countingMode=false;
let counted=0;
let isDragging=false;
let startX=0,startY=0,startLeft=0,startTop=0;

/* yardımcılar */
function randomItem(){return pool[Math.floor(Math.random()*pool.length)];}
function speakTR(text){
  if(!("speechSynthesis" in window)) return;
  const u=new SpeechSynthesisUtterance(text);
  u.lang="tr-TR";
  window.speechSynthesis.speak(u);
}

/* yeni nesne */
function loadNew(){
  currentItem=randomItem();
  do{wrongItem=randomItem();}while(wrongItem.id===currentItem.id);
  attempt=1;
  renderQuestion(true);
}

function renderQuestion(shuffle){
  instruction.textContent=`${currentItem.tr.toUpperCase()} EŞLE`;
  const correctData={id:currentItem.id,tr:currentItem.tr,img:`assets/${currentItem.id}.png`};
  const wrongData={id:wrongItem.id,tr:wrongItem.tr,img:`assets/${wrongItem.id}.png`};
  let arr=[correctData,wrongData];
  if(shuffle)arr.sort(()=>Math.random()-.5);

  leftImg.src=arr[0].img;leftImg.dataset.id=arr[0].id;leftLabel.textContent=arr[0].tr.toUpperCase();
  rightImg.src=arr[1].img;rightImg.dataset.id=arr[1].id;rightLabel.textContent=arr[1].tr.toUpperCase();

  dragImg.src=`assets/${currentItem.id}.png`;
  dragLabel.textContent=currentItem.tr.toUpperCase();

  resetDragPosition();
  // mini bar görünümü yenile (kart altındaki)
  refreshMiniBar();
}

function resetDragPosition(){
  dragCard.style.transition="all .25s ease";
  dragCard.style.bottom="14%";
  dragCard.style.left="50%";
  dragCard.style.top="";
  dragCard.style.transform="translateX(-50%)";
}

/* drag events */
function dragStart(e){
  e.preventDefault();
  isDragging=true;
  const p=e.touches?e.touches[0]:e;
  startX=p.clientX;startY=p.clientY;
  const rect=dragCard.getBoundingClientRect();
  startLeft=rect.left;startTop=rect.top;
  dragCard.style.transition="none";
  dragCard.style.cursor="grabbing";

  document.addEventListener("mousemove",dragging);
  document.addEventListener("touchmove",dragging,{passive:false});
  document.addEventListener("mouseup",dragEnd);
  document.addEventListener("touchend",dragEnd);
}
function dragging(e){
  if(!isDragging)return;
  const p=e.touches?e.touches[0]:e;
  const dx=p.clientX-startX;
  const dy=p.clientY-startY;
  dragCard.style.left=(startLeft+dx)+"px";
  dragCard.style.top=(startTop+dy)+"px";
  dragCard.style.transform="none";
}
function dragEnd(e){
  if(!isDragging)return;
  isDragging=false;
  dragCard.style.cursor="grab";
  document.removeEventListener("mousemove",dragging);
  document.removeEventListener("touchmove",dragging);
  document.removeEventListener("mouseup",dragEnd);
  document.removeEventListener("touchend",dragEnd);

  const dRect=dragCard.getBoundingClientRect();
  const lRect=optionLeft.getBoundingClientRect();
  const rRect=optionRight.getBoundingClientRect();
  const hitL=isOverlap(dRect,lRect);
  const hitR=isOverlap(dRect,rRect);

  if(hitL||hitR){
    const chosenId=hitL?leftImg.dataset.id:rightImg.dataset.id;
    if(chosenId===currentItem.id) handleCorrect();
    else handleWrong();
  }else{
    resetDragPosition();
  }
}
function isOverlap(a,b){
  return !(a.right<b.left || a.left>b.right || a.bottom<b.top || a.top>b.bottom);
}

/* doğru / yanlış */
function handleCorrect(){
  dragCard.classList.add("correct");
  // random pekiştireç
  const randomMsg = praiseTexts[Math.floor(Math.random()*praiseTexts.length)];
  speakTR(randomMsg);

  correctSound.currentTime=0;
  correctSound.play().catch(()=>{});
  // her doğruya sembol kazan
  gainSymbol(); // V19: buraya çekildi

  if(attempt===1){
    setTimeout(()=>{
      dragCard.classList.remove("correct");
      swapTopCards();
      attempt=2;
      resetDragPosition();
    },500);
  }else{
    setTimeout(()=>{
      dragCard.classList.remove("correct");
      loadNew();
    },500);
  }
}

function handleWrong(){
  dragCard.classList.add("wrong");
  wrongSound.currentTime=0;
  wrongSound.play().catch(()=>{});
  setTimeout(()=>{
    dragCard.classList.remove("wrong");
    resetDragPosition();
  },500);
}

function swapTopCards(){
  // içerikleri değiştir
  const tSrc=leftImg.src, tLbl=leftLabel.textContent, tId=leftImg.dataset.id;
  leftImg.src=rightImg.src;leftLabel.textContent=rightLabel.textContent;leftImg.dataset.id=rightImg.dataset.id;
  rightImg.src=tSrc;rightLabel.textContent=tLbl;rightImg.dataset.id=tId;
}

/* kart altındaki mini barı ekrana göre güncelle */
function refreshMiniBar(){
  // mini bar: gösterilecek kadarını doldur
  for(let i=0;i<miniSlots.length;i++){
    if(i<symbolCount){
      miniSlots[i].textContent="⭐";
      miniSlots[i].style.opacity=1;
    }else{
      miniSlots[i].textContent="";
      miniSlots[i].style.opacity=.2;
    }
  }
}

/* sembol kazanımı */
function gainSymbol(){
  if(symbolCount>=10) return; // 10'dan fazla olmasın

  // 1) kart altındaki mini barda göster
  if(symbolCount < miniSlots.length){
    miniSlots[symbolCount].textContent="⭐";
    miniSlots[symbolCount].style.opacity=1;
  }

  // 2) uçan yıldız efekti (karttan tahtaya)
  flyStar.style.opacity=1;
  flyStar.style.transform="translate(-50%,-50%) scale(1)";
  setTimeout(()=>{
    flyStar.style.opacity=0;
    flyStar.style.transform="translate(-50%,-50%) scale(0)";
  },300);

  // 3) tahtaya yaz
  slots[symbolCount].textContent="⭐";
  slots[symbolCount].classList.add("active");
  symbolCount++;

  // sayıyla da söyle
  const sayilar=["bir","iki","üç","dört","beş","altı","yedi","sekiz","dokuz","on"];
  speakTR(sayilar[symbolCount-1]);

  // 4) eğer 10 olduysa sayma moduna geç
  if(symbolCount===10){
    speakTR("Hadi sembolleri sayalım.");
    countingMode=true;
    counted=0;
  }
}

/* sembollere tıklayıp sayma ve kart altına geri getirme */
slots.forEach((slot,idx)=>{
  slot.addEventListener("click",()=>{
    if(!countingMode) return;
    if(!slot.classList.contains("active")) return;

    // tahtadan çıkar
    slot.classList.remove("active");
    slot.textContent="";

    counted++;
    const sayilar=["bir","iki","üç","dört","beş","altı","yedi","sekiz","dokuz","on"];
    speakTR(sayilar[counted-1]);

    // kart altındaki mini barda ilgili sıraya geri yerleştir
    if(counted-1 < miniSlots.length){
      miniSlots[counted-1].textContent="⭐";
      miniSlots[counted-1].style.opacity=1;
    }

    // tahta yıldızını animasyonla kaldır
    slot.style.transform="translateY(-35px)";
    slot.style.opacity=0;
    setTimeout(()=>{slot.style.transform="";slot.style.opacity=1;},500);

    if(counted===10){
      setTimeout(()=>{
        speakTR("Aferin, tüm sembolleri topladın.");
        praiseSound.currentTime=0;
        praiseSound.play().catch(()=>{});
        // her şeyi sıfırla
        slots.forEach(s=>{s.textContent="";s.classList.remove("active");});
        symbolCount=0;
        countingMode=false;
        counted=0;
        // kart altındaki mini barı da boşalt
        miniSlots.forEach(ms=>{ms.textContent="";ms.style.opacity=.2;});
      },700);
    }
  });
});

/* olaylar */
dragCard.addEventListener("mousedown",dragStart);
dragCard.addEventListener("touchstart",dragStart,{passive:false});

window.addEventListener("load",()=>{
  loadNew();
});
</script>
</body>
</html>
