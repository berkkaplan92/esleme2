<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>V17 – 2 Seçenekli Sürükle Bırak</title>
  <style>
    body {
      margin: 0;
      background: linear-gradient(to bottom right, #b3e5fc, #e1f5fe);
      height: 100vh;
      overflow: hidden;
      font-family: "Comic Sans MS", system-ui, sans-serif;
      position: relative;
    }

    /* Yönerge */
    #instruction {
      position: absolute;
      top: 12px;
      left: 16px;
      background: rgba(255, 255, 255, 0.9);
      padding: 8px 16px;
      border-radius: 12px;
      font-weight: 700;
      text-transform: uppercase;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.12);
      z-index: 1000;
    }

    /* Üstteki 2 sabit kart */
    .option-card {
      width: 160px;
      height: 200px;
      background: #fff;
      border: 3px solid rgba(11, 132, 165, 0.4);
      border-radius: 16px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      position: absolute;
      transition: all 0.35s ease;
      user-select: none;
      z-index: 10;
    }

    #optionLeft {
      top: 14%;
      left: 20%;
    }

    #optionRight {
      top: 14%;
      right: 20%;
    }

    .option-card img {
      width: 100px;
      height: 100px;
      object-fit: contain;
      margin-top: 10px;
      pointer-events: none;
    }
    .label {
      font-weight: 700;
      text-transform: uppercase;
      margin-top: 8px;
      text-align: center;
    }

    /* Alttaki sürüklenen kart */
    #dragCard {
      width: 160px;
      height: 200px;
      background: #fff;
      border: 3px solid rgba(11, 132, 165, 0.6);
      border-radius: 16px;
      box-shadow: 0 6px 10px rgba(0, 0, 0, 0.35);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      position: absolute;
      bottom: 14%;
      left: 50%;
      transform: translateX(-50%);
      cursor: grab;
      user-select: none;
      touch-action: none;
      z-index: 200;
      transition: box-shadow .15s ease, border-color .15s ease;
    }

    #dragCard img {
      width: 100px;
      height: 100px;
      object-fit: contain;
      margin-top: 10px;
      pointer-events: none;
    }

    .correct {
      border-color: #2ecc71 !important;
      box-shadow: 0 0 18px rgba(46, 204, 113, 0.9) !important;
    }

    .wrong {
      border-color: #e74c3c !important;
      box-shadow: 0 0 18px rgba(231, 76, 60, 0.9) !important;
    }

    /* sembol tahtası */
    #symbolBoard {
      position: absolute;
      bottom: 20px;
      right: 20px;
      width: 280px;
      height: 130px;
      background: url('https://cdn.pixabay.com/photo/2014/04/02/10/56/wood-306955_1280.png') center/cover no-repeat;
      border-radius: 16px;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      align-items: center;
      padding: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.25);
    }

    .slot {
      width: 28px;
      height: 28px;
      border-radius: 8px;
      background: rgba(255,255,255,0.3);
      margin: 4px;
      font-size: 22px;
      text-align: center;
      line-height: 28px;
      opacity: .25;
    }
    .slot.active {
      opacity: 1;
    }

    /* ortada beliren yıldız */
    #flyStar {
      position: absolute;
      width: 60px;
      height: 60px;
      background: gold;
      border-radius: 50%;
      box-shadow: 0 0 12px rgba(255,215,0,.9);
      top: 50%;
      left: 50%;
      transform: translate(-50%,-50%) scale(0);
      opacity: 0;
      pointer-events: none;
      z-index: 999;
      transition: all .25s ease;
    }

    @media (max-width: 500px) {
      #optionLeft { left: 5%; }
      #optionRight { right: 5%; }
      #symbolBoard { transform: scale(.85); right: 4px; }
    }
  </style>
</head>
<body>
  <div id="instruction">YÖNERGE: EŞLE</div>

  <!-- üstte sabit -->
  <div class="option-card" id="optionLeft">
    <img id="leftImg" src="" alt="">
    <div class="label" id="leftLabel"></div>
  </div>
  <div class="option-card" id="optionRight">
    <img id="rightImg" src="" alt="">
    <div class="label" id="rightLabel"></div>
  </div>

  <!-- altta sürüklenen -->
  <div class="card" id="dragCard">
    <img id="dragImg" src="" alt="">
    <div class="label" id="dragLabel"></div>
  </div>

  <!-- sembol tahtası -->
  <div id="symbolBoard"></div>
  <div id="flyStar"></div>

  <!-- sesler -->
  <audio id="correctSound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_bf4d03054b.mp3"></audio>
  <audio id="wrongSound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_21cda77a64.mp3"></audio>
  <audio id="praise" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_c3b37f01ab.mp3"></audio>

  <script>
    // ----- VERİ HAVUZU -----
    const pool = [
      {id:"elma", tr:"Elma"},
      {id:"muz", tr:"Muz"},
      {id:"armut", tr:"Armut"},
      {id:"patlican", tr:"Patlıcan"},
      {id:"domates", tr:"Domates"},
      {id:"sarimsak", tr:"Sarımsak"},
      {id:"araba", tr:"Araba"},
      {id:"otobus", tr:"Otobüs"},
      {id:"ucak", tr:"Uçak"},
      {id:"kopek", tr:"Köpek"}
    ];

    // ----- ELEMENTLER -----
    const instruction = document.getElementById('instruction');
    const leftImg = document.getElementById('leftImg');
    const rightImg = document.getElementById('rightImg');
    const leftLabel = document.getElementById('leftLabel');
    const rightLabel = document.getElementById('rightLabel');

    const dragCard = document.getElementById('dragCard');
    const dragImg = document.getElementById('dragImg');
    const dragLabel = document.getElementById('dragLabel');

    const optionLeft = document.getElementById('optionLeft');
    const optionRight = document.getElementById('optionRight');

    const symbolBoard = document.getElementById('symbolBoard');
    const flyStar = document.getElementById('flyStar');

    const correctSound = document.getElementById('correctSound');
    const wrongSound = document.getElementById('wrongSound');
    const praiseSound = document.getElementById('praise');

    // sembol tahtasını 10'lu üret
    let slots = [];
    for (let i=0; i<10; i++) {
      const s = document.createElement('div');
      s.className = 'slot';
      symbolBoard.appendChild(s);
      slots.push(s);
    }

    // ----- DURUMLAR -----
    let currentItem = null;
    let wrongItem = null;
    let attempt = 1;           // 1. doğru mu 2. doğru mu
    let symbolCount = 0;

    // drag için
    let isDragging = false;
    let startX = 0, startY = 0;
    let startLeft = 0, startTop = 0;

    // ----- YARDIMCI -----
    function randomItem() {
      return pool[Math.floor(Math.random() * pool.length)];
    }

    function speakTR(text) {
      if (!('speechSynthesis' in window)) return;
      const u = new SpeechSynthesisUtterance(text);
      u.lang = "tr-TR";
      window.speechSynthesis.speak(u);
    }

    function loadNew() {
      currentItem = randomItem();
      do {
        wrongItem = randomItem();
      } while (wrongItem.id === currentItem.id);
      attempt = 1;
      renderQuestion(true);
    }

    function renderQuestion(shuffle) {
      instruction.textContent = `${currentItem.tr.toUpperCase()} EŞLE`;

      const correctData = { id: currentItem.id, tr: currentItem.tr, img: `assets/${currentItem.id}.png` };
      const wrongData   = { id: wrongItem.id,   tr: wrongItem.tr,   img: `assets/${wrongItem.id}.png`   };

      let arr = [correctData, wrongData];
      if (shuffle) arr.sort(() => Math.random() - 0.5);

      // üstteki iki kartı doldur
      leftImg.src = arr[0].img;
      leftImg.dataset.id = arr[0].id;
      leftLabel.textContent = arr[0].tr.toUpperCase();

      rightImg.src = arr[1].img;
      rightImg.dataset.id = arr[1].id;
      rightLabel.textContent = arr[1].tr.toUpperCase();

      // alttaki kart: hedef
      dragImg.src = `assets/${currentItem.id}.png`;
      dragLabel.textContent = currentItem.tr.toUpperCase();

      resetDragPosition();
    }

    function resetDragPosition() {
      // alttaki kartı tekrar ortaya al
      dragCard.style.transition = "all .25s ease";
      dragCard.style.bottom = "14%";
      dragCard.style.left = "50%";
      dragCard.style.top = "";
      dragCard.style.transform = "translateX(-50%)";
    }

    // ----- DRAG LOGIC -----
    function dragStart(e) {
      e.preventDefault();
      isDragging = true;
      const point = e.touches ? e.touches[0] : e;
      startX = point.clientX;
      startY = point.clientY;

      const rect = dragCard.getBoundingClientRect();
      startLeft = rect.left;
      startTop = rect.top;

      dragCard.style.transition = "none";
      dragCard.style.cursor = "grabbing";

      document.addEventListener('mousemove', dragging);
      document.addEventListener('touchmove', dragging, {passive:false});
      document.addEventListener('mouseup', dragEnd);
      document.addEventListener('touchend', dragEnd);
    }

    function dragging(e) {
      if (!isDragging) return;
      const point = e.touches ? e.touches[0] : e;
      const dx = point.clientX - startX;
      const dy = point.clientY - startY;

      dragCard.style.left = (startLeft + dx) + "px";
      dragCard.style.top  = (startTop + dy) + "px";
      dragCard.style.transform = "none";
    }

    function dragEnd(e) {
      if (!isDragging) return;
      isDragging = false;
      dragCard.style.cursor = "grab";

      document.removeEventListener('mousemove', dragging);
      document.removeEventListener('touchmove', dragging);
      document.removeEventListener('mouseup', dragEnd);
      document.removeEventListener('touchend', dragEnd);

      // çarpışma kontrolü
      const dragRect = dragCard.getBoundingClientRect();
      const leftRect = optionLeft.getBoundingClientRect();
      const rightRect = optionRight.getBoundingClientRect();

      const hitLeft = isOverlap(dragRect, leftRect);
      const hitRight = isOverlap(dragRect, rightRect);

      if (hitLeft || hitRight) {
        const targetId = hitLeft ? leftImg.dataset.id : rightImg.dataset.id;
        if (targetId === currentItem.id) {
          handleCorrect();
        } else {
          handleWrong();
        }
      } else {
        resetDragPosition();
      }
    }

    function isOverlap(a, b) {
      return !(
        a.right < b.left ||
        a.left > b.right ||
        a.bottom < b.top ||
        a.top > b.bottom
      );
    }

    // ----- DOĞRU / YANLIŞ -----
    function handleCorrect() {
      dragCard.classList.add("correct");
      correctSound.currentTime = 0;
      correctSound.play().catch(()=>{});

      if (attempt === 1) {
        // aynı nesneyi 2. kez soracağız ama üsttekilerin yerini değiştir
        setTimeout(() => {
          dragCard.classList.remove("correct");
          swapTopCards();
          attempt = 2;
          resetDragPosition();
        }, 500);
      } else {
        // 2. kez de doğru yaptı -> sembol + yeni nesne
        gainSymbol();
        setTimeout(() => {
          dragCard.classList.remove("correct");
          loadNew();
        }, 500);
      }
    }

    function handleWrong() {
      dragCard.classList.add("wrong");
      wrongSound.currentTime = 0;
      wrongSound.play().catch(()=>{});
      setTimeout(() => {
        dragCard.classList.remove("wrong");
        resetDragPosition();
      }, 500);
    }

    // ----- ÜST KARTLARI YER DEĞİŞTİR -----
    function swapTopCards() {
      // görsel yer değişimi
      const tmpSrc = leftImg.src;
      const tmpLabel = leftLabel.textContent;
      const tmpId = leftImg.dataset.id;

      leftImg.src = rightImg.src;
      leftLabel.textContent = rightLabel.textContent;
      leftImg.dataset.id = rightImg.dataset.id;

      rightImg.src = tmpSrc;
      rightLabel.textContent = tmpLabel;
      rightImg.dataset.id = tmpId;

      // pozisyonları animasyonlu olsun diye sadece left/right değiştirmedik
      // çünkü ilk başta zaten 20% – 20% hizalılar
    }

    // ----- SEMBOL -----
    function gainSymbol() {
      // --- V18: Sembolleri Sayma Sistemi ---
let countingMode = false;
let counted = 0;

// sembollere tıklayınca sayma
slots.forEach((s, idx) => {
  s.addEventListener("click", () => {
    if (!countingMode || !s.classList.contains("active")) return;
    s.classList.remove("active");
    s.textContent = "";
    counted++;
    const sayilar = ["bir","iki","üç","dört","beş","altı","yedi","sekiz","dokuz","on"];
    speakTR(sayilar[counted-1]);
    s.style.transition = "all .5s ease";
    s.style.transform = "translateY(-40px)";
    s.style.opacity = 0;
    setTimeout(() => { s.style.transform = ""; s.style.opacity = 1; }, 600);

    if (counted === 10) {
      setTimeout(() => {
        const aferinSes = new Audio("https://cdn.pixabay.com/download/audio/2022/03/15/audio_c3b37f01ab.mp3");
        speakTR("Aferin, tüm sembolleri topladın!");
        aferinSes.play();
        slots.forEach(x => {x.textContent="";x.classList.remove("active");});
        symbolCount = 0;
        countingMode = false;
        counted = 0;
      }, 800);
    }
  });
});

    // ----- OLAYLAR -----
    dragCard.addEventListener('mousedown', dragStart);
    dragCard.addEventListener('touchstart', dragStart, {passive:false});

    window.addEventListener('load', () => {
      loadNew();
    });
  </script>
</body>
</html>
